---
// src/pages/index.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import ProjectCard from '../components/ProjectCard.astro';
import Sidebar from '../components/Sidebar.astro';
import { getCollection } from 'astro:content';

const allProjects = await getCollection('projects');
const featuredProjects = allProjects.filter(p => p.data.isFeatured);

let recentProjects;
if (featuredProjects.length > 0) {
    // Top 8 featured projects
    recentProjects = featuredProjects.slice(0, 8);
} else {
    // Fallback: Limit to 8 projects for the highlights section if there are many
    recentProjects = allProjects.slice(0, 8);
}
---

<BaseLayout 
  title="Long Ngo | Product Designer" 
  description="Portfolio của Long Ngo - Product Designer chuyên giải quyết các vấn đề phức tạp bằng giao diện đơn giản."
>
  
  <div class="flex flex-col lg:flex-row gap-6 h-full">
    <!-- Left Sidebar -->
    <Sidebar />

    <!-- Right Content Area -->
    <div class="flex-1 min-w-0">
      <div class="glass-panel rounded-3xl p-8 h-full flex flex-col">
        
        <!-- Section Header -->
        <div class="flex justify-between items-start mb-8">
          <div>
            <h2 class="text-2xl font-bold font-display text-white mb-2">Portfolio Highlights</h2>
            <p class="text-white/85 text-sm">A collection of my recent projects.</p>
          </div>
          
          <a href="/projects" class="px-6 py-2.5 rounded-xl bg-white/10 hover:bg-white/20 border border-white/10 text-white text-sm font-medium transition-all flex items-center gap-2 group">
            View All
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>

        <!-- Projects Grid -->
        <!-- Projects Grid (Vision Pro) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 overflow-y-auto pr-2 custom-scrollbar flex-1 pb-4">
          {recentProjects.map((project) => (
            <div class="mb-6">
              <ProjectCard 
                title={project.data.title}
                description={project.data.description}
                category={project.data.category}
                coverImage={project.data.coverImage}
                slug={project.slug}
              />
            </div>
          ))}
        </div>

      </div>
    </div>
  </div>

</BaseLayout>
